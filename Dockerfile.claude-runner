FROM node:22-slim

RUN apt-get update \
    && apt-get install -y --no-install-recommends curl ca-certificates git \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY scripts/claude_runner_server.mjs /app/scripts/claude_runner_server.mjs

USER node
RUN curl -fsSL https://claude.ai/install.sh | bash

ENV PATH="/home/node/.local/bin:${PATH}" \
    CLAUDE_RUNNER_HOST=0.0.0.0 \
    CLAUDE_RUNNER_PORT=8787 \
    CLAUDE_RUNNER_WORKDIR=/workspace \
    CLAUDE_RUNNER_TIMEOUT_MS=300000

CMD ["node", "/app/scripts/claude_runner_server.mjs"]
